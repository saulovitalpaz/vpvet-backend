from flask import Blueprint
from flask_jwt_extended import jwt_required, get_jwt_identity
from functools import wraps
from models.user import User

# Create the admin blueprint
admin_bp = Blueprint('admin', __name__, url_prefix='/api/admin')

def admin_required(f):
    """
    Decorator to ensure only Dr. Saulo (system owner) can access admin endpoints
    """
    @wraps(f)
    @jwt_required()
    def decorated_function(*args, **kwargs):
        current_user_id = get_jwt_identity()
        user = User.query.get(current_user_id)

        if not user or not user.is_dr_saulo:
            return {'error': 'Access denied. Admin privileges required.'}, 403

        return f(*args, **kwargs)

    return decorated_function

# Import all admin routes
from app.api.admin import clinics, users, clients, analytics, uploads